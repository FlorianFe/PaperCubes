

{{#each pages}}
<svg width="100%" viewBox="0 0 {{add ../width 2}} {{add ../height 2}}">
  {{#each tiles}}
    <path
      transform="translate({{mul (add x 0.5) 1}}, {{mul (add y 0.5) 1}}) rotate({{texturerotation type metaType normal}}) translate(-{{mul (add x 0.5) 1}}, -{{mul (add y 0.5) 1}})"
      fill="url(#{{texture type metaType normal textureOffset}})"
      d="M {{mul x 1}} {{mul y 1}} L {{mul x 1}} {{add (mul y 1) 1}} L {{add (mul x 1) 1}} {{add (mul y 1) 1}} L {{add (mul x 1) 1}} {{mul y 1}}"
    />
  {{/each}}

  {{#each links}}
    <g
      transform="translate({{mul (add x 0.5) 1}}, {{mul (add y 0.5) 1}}) rotate({{rotation orientation}})">
    >
      {{#if opened}}
      <path
        class="tab {{#if concarve}}concarve{{else}}convex{{/if}}"
        stroke-width="0.005"
        stroke-dasharray="{{mul 2 0.02}},{{mul 2 0.02}}"
        d="M {{mul -0.5 1}} {{mul -0.5 1}} L {{mul -0.4 1}} {{mul -0.5 1}} L {{mul -0.3 1}} {{mul -0.3 1}} L {{mul 0.3 1}} {{mul -0.3 1}} L {{mul 0.4 1}} {{mul -0.5 1}} L {{mul 0.5 1}} {{mul -0.5 1}}"
      />

      <path
        class="void-room"
        stroke-width="0.005"
        stroke-dasharray="{{mul 2 0.02}},{{mul 2 0.02}}"
        d="M {{mul 0.25 1}} {{mul -0.5 1}} L {{mul 0.2 1}} {{mul -0.45 1}} L {{mul -0.2 1}} {{mul -0.45 1}} L {{mul -0.25 1}} {{mul -0.5 1}} Z"
      />

      <text
        transform="rotate(180)"
        font-size="0.075"
        fill="black"
        font-family="Verdana"
        text-anchor="middle"
        alignment-baseline="baseline"
        x="0"
        y="0.4"
      >
      {{else}}
      <path
        class="tab {{#if concarve}}concarve{{else}}convex{{/if}}"
        stroke-width="0.005"
        stroke-dasharray="{{mul 2 0.02}},{{mul 2 0.02}}"
        d="M {{mul -0.5 1}} {{mul -0.5 1}} L {{mul -0.25 1}} {{mul -0.5 1}} L {{mul -0.2 1}} {{mul -0.2 1}} L {{mul 0.2 1}} {{mul -0.2 1}} L {{mul 0.25 1}} {{mul -0.5 1}} L {{mul 0.5 1}} {{mul -0.5 1}}"
      />

      <text
        transform="rotate(180)"
        font-size="0.075"
        fill="black"
        font-family="Verdana"
        text-anchor="middle"
        alignment-baseline="baseline"
        x="0"
        y="{{mul 0.35 1}}"
      >
      {{/if}}

        {{ index }}
      </text>
    </g>

    {{/each}}
</svg>
  {{#unless @last}}
  <hr class="page-start">
  {{/unless}}
{{/each}}

<svg
  width="0" height="0"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">


    <defs id="defs">
      {{#each textures}}
      <pattern id="{{this}}_0_0" x="0" y="0" width="1" height="1">
        <image
          x="0" y="-1" width="2" height="2" preserveAspectRatio="xMinYMin slice"
          xlink:href="{{../texturePath}}/{{this}}.png"
        ></image>
      </pattern>
      <pattern id="{{this}}_1_0" x="0" y="0" width="1" height="1">
        <image
          x="-1" y="-1" width="2" height="2" preserveAspectRatio="xMinYMin slice"
          xlink:href="{{../texturePath}}/{{this}}.png"
        ></image>
      </pattern>
      <pattern id="{{this}}_0_1" x="0" y="0" width="1" height="1">
        <image
          x="0" y="0" width="2" height="2" preserveAspectRatio="xMinYMin slice"
          xlink:href="{{../texturePath}}/{{this}}.png"
        ></image>
      </pattern>
      <pattern id="{{this}}_1_1" x="0" y="0" width="1" height="1">
        <image
          x="-1" y="0" width="2" height="2" preserveAspectRatio="xMinYMin slice"
          xlink:href="{{../texturePath}}/{{this}}.png"
        ></image>
      </pattern>
      {{/each}}
    </defs>
  </defs>
</svg>
